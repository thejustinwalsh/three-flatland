---
title: TSL Nodes
description: Create custom shader effects using Three Shader Language nodes.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';
import ExamplePreview from '../../../components/ExamplePreview';
import StackBlitzEmbed from '../../../components/StackBlitzEmbed';
import ExampleTabs from '../../../components/ExampleTabs.astro';
import { loadExample } from '../../../utils/loadExample';

export const vanillaFiles = loadExample('vanilla', 'tsl-nodes');
export const reactFiles = loadExample('react', 'tsl-nodes');

<ExampleTabs>
<Tabs>
  <TabItem label="Preview" icon="rocket">
    <ExamplePreview client:load type="vanilla" name="tsl-nodes" />
  </TabItem>
  <TabItem label="Three.js" icon="seti:javascript">
    <StackBlitzEmbed
      client:load
      title="TSL Nodes - Three.js"
      files={vanillaFiles}
      openFile="main.ts"
      height={600}
    />
  </TabItem>
  <TabItem label="React" icon="seti:react">
    <StackBlitzEmbed
      client:load
      title="TSL Nodes - React"
      files={reactFiles}
      openFile="App.tsx"
      height={600}
    />
  </TabItem>
</Tabs>
</ExampleTabs>

## What This Example Shows

This example demonstrates the **Material Effect** system — the recommended way to create per-sprite shader effects. It showcases 8 visual modes on an animated sprite:

| Effect | Description |
|--------|-------------|
| Normal | No effect — base sprite rendering |
| Damage Flash | Additive white flash that fades out |
| Dissolve | Pixelated noise-based dissolve |
| Powerup | Continuous hue rotation (rainbow) |
| Petrify | Desaturation to grayscale |
| Select | Green outline around sprite |
| Shadow | Dark blue tint with reduced alpha |
| Pixelate | Resolution reduction and restoration |

## Defining Effects

Effects are defined with `createMaterialEffect`, which takes a schema for per-sprite data and a TSL node builder:

<Tabs syncKey="framework">
  <TabItem label="Three.js" icon="seti:javascript">
    ```typescript
    import { createMaterialEffect, tintAdditive, hueShift } from '@three-flatland/core'
    import { vec4 } from 'three/tsl'

    const DamageFlash = createMaterialEffect({
      name: 'damageFlash',
      schema: { intensity: 1 } as const,
      node: ({ inputColor, attrs }) => {
        const flashed = tintAdditive(inputColor, [1, 1, 1], attrs.intensity)
        return vec4(flashed.rgb.mul(inputColor.a), inputColor.a)
      },
    })

    const Powerup = createMaterialEffect({
      name: 'powerup',
      schema: { angle: 0 } as const,
      node: ({ inputColor, attrs }) => hueShift(inputColor, attrs.angle),
    })
    ```
  </TabItem>
  <TabItem label="React" icon="seti:react">
    ```tsx
    import { createMaterialEffect, tintAdditive, hueShift } from '@three-flatland/react'
    import { vec4 } from 'three/tsl'

    const DamageFlash = createMaterialEffect({
      name: 'damageFlash',
      schema: { intensity: 1 } as const,
      node: ({ inputColor, attrs }) => {
        const flashed = tintAdditive(inputColor, [1, 1, 1], attrs.intensity)
        return vec4(flashed.rgb.mul(inputColor.a), inputColor.a)
      },
    })

    const Powerup = createMaterialEffect({
      name: 'powerup',
      schema: { angle: 0 } as const,
      node: ({ inputColor, attrs }) => hueShift(inputColor, attrs.angle),
    })
    ```
  </TabItem>
</Tabs>

## Applying Effects at Runtime

Instantiate an effect, add it to a sprite, and animate its properties:

<Tabs syncKey="framework">
  <TabItem label="Three.js" icon="seti:javascript">
    ```typescript
    const flash = new DamageFlash()
    sprite.addEffect(flash)

    // Animate in render loop
    flash.intensity = Math.max(0, 1 - elapsed / 0.3)

    // Switch effects
    sprite.removeEffect(flash)
    ```
  </TabItem>
  <TabItem label="React" icon="seti:react">
    ```tsx
    const flash = useMemo(() => new DamageFlash(), [])

    useEffect(() => {
      sprite.addEffect(flash)
      return () => sprite.removeEffect(flash)
    }, [sprite, flash])

    useFrame((_, delta) => {
      flash.intensity = Math.max(0, flash.intensity - delta / 0.3)
    })
    ```
  </TabItem>
</Tabs>

## Next Steps

- [TSL Nodes Guide](/guides/tsl-nodes) - Full node reference and Material Effect documentation
- [Tilemap](/examples/tilemap) - Tile-based map rendering
